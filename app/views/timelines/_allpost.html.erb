<% @plurks.each do |plurk| %>
  <div class="plurk-main">
    <div class="plurk-body">
      <span class="close-button">
        <%= link_to '✕', plurk, method: :delete, data: { confirm: 'Are you sure?' } %>
      </span>
      <%= link_to plurk.user.nickname, user_path(plurk.user) %> <span class="plurk-time"> <%= l plurk.created_at, format: :short %> </span>
      <button type="button" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#plurk-content-id-<%= plurk.id %>">
        Edit
      </button>
      <!-- Modal -->
      <div class="modal fade" id="plurk-content-id-<%= plurk.id %>" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title" id="myModalLabel">Edit Plurk</h4>
            </div>
            <%= form_for plurk do |f| %>
              <div class="modal-body">
                <%= f.text_area :content, :required=>true %>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <%= f.submit "Save changes", class: "btn btn-primary" %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
      <button class="btn btn-default btn-xs"  type="button" data-toggle="collapse" data-target="#collapse-reply-id-<%= plurk.id %>" aria-expanded="false" aria-controls="collapse-reply-id-<%= plurk.id %>">
        ↪︎ Reply
      </button>
      <div class="plurk-content">
        <%= plurk.content %>
      </div>
      <div class="collapse" id="collapse-reply-id-<%= plurk.id %>">
        <%= render partial: 'reply_input', locals: {plurk: plurk} %>
      </div>
    </div>
    <% if plurk.replies.present? %>
      <% plurk.replies.each do |reply| %>
        <div class="plurk-reply">
          <%= link_to reply.user.nickname, user_path(reply.user) %>
          <span class="plurk-time"><%= l reply.created_at, format: :short %> </span>
          <div class="reply-content">
            <%= reply.content %>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>
<% end %>
